<body id="myBody" style="background-repeat:repeat; background-size: 80%" background="myBackground01.jpg" onload="{myAuto()}">

<h1 align=center><font color=red>T4A04 Flappy Bird Style Game</font></h1>

<script>
   // Global variables
   let myClock;
   let myGravity = 1.0; // Increased gravity force for faster falling
   let myJumpStrength = -10; // Jump strength
   let myVerticalVelocity = 0; // Current vertical velocity
   let jumpCount = 0; // Counter for jumps
   let maxJumps = 2; // Maximum number of jumps allowed
   let score = 0; // Score variable
   let gameOver = false; // Game over state
   const pipeWidth = 50; // Width of the pipes
   const pipeGap = 200; // Increased gap between pipes
   const pipeFrequency = 2000; // Frequency of pipe generation in milliseconds

   // Initialize the game
   function myAuto() {
       clearInterval(myClock);
       myClock = setInterval(function() {
           if (!gameOver) {
               myDoGravity();
               myCheckHit(); // Check for collisions
           }
       }, 100);
       setInterval(createPipe, pipeFrequency); // Create pipes at intervals
   }

   // Create pipes
   function createPipe() {
       const pipeHeight = Math.floor(Math.random() * (window.innerHeight - pipeGap - 100)) + 50; // Random height
       const pipeTop = document.createElement('div');
       const pipeBottom = document.createElement('div');

       pipeTop.style.position = 'absolute';
       pipeTop.style.width = pipeWidth + 'px';
       pipeTop.style.height = pipeHeight + 'px';
       pipeTop.style.left = window.innerWidth + 'px';
       pipeTop.style.top = '0';
       pipeTop.style.backgroundColor = 'green';
       document.body.appendChild(pipeTop);

       pipeBottom.style.position = 'absolute';
       pipeBottom.style.width = pipeWidth + 'px';
       pipeBottom.style.height = (window.innerHeight - pipeHeight - pipeGap) + 'px';
       pipeBottom.style.left = window.innerWidth + 'px';
       pipeBottom.style.bottom = '0';
       pipeBottom.style.backgroundColor = 'green';
       document.body.appendChild(pipeBottom);

       movePipes(pipeTop, pipeBottom);
   }

   // Move pipes across the screen
   function movePipes(pipeTop, pipeBottom) {
       const moveInterval = setInterval(function() {
           if (gameOver) {
               clearInterval(moveInterval);
               return;
           }
           const pipeLeft = parseInt(pipeTop.style.left);
           pipeTop.style.left = (pipeLeft - 5) + 'px';
           pipeBottom.style.left = (pipeLeft - 5) + 'px';

           // Check if the pipe is off-screen
           if (pipeLeft < -pipeWidth) {
               clearInterval(moveInterval);
               document.body.removeChild(pipeTop);
               document.body.removeChild(pipeBottom);
               score++; // Increase score
               console.log("Score: " + score); // Display score in console
           }
       }, 100);
   }

   // Gravity and movement
   function myDoGravity() {
       let img = document.getElementById('myImg01');
       myVerticalVelocity += myGravity; // Apply gravity to vertical velocity
       img.style.top = parseInt(img.style.top) + myVerticalVelocity + 'px'; // Update position

       // Check for ground collision
       if (parseInt(img.style.top) >= window.innerHeight - img.offsetHeight) {
           img.style.top = (window.innerHeight - img.offsetHeight) + 'px'; // Reset to ground level
           myVerticalVelocity = 0; // Reset vertical velocity
           gameOver = true; // Set game over state
           alert("Game Over! Your score: " + score);
       }
   }

   // Check for collisions with pipes
   function myCheckHit() {
       const img = document.getElementById('myImg01');
       const pipes = document.querySelectorAll('div'); // Get all pipes

       pipes.forEach(pipe => {
           const pipeRect = pipe.getBoundingClientRect();
           const imgRect = img.getBoundingClientRect();

           if (pipeRect.left < imgRect.right && pipeRect.right > imgRect.left &&
               pipeRect.top < imgRect.bottom && pipeRect.bottom > imgRect.top) {
               gameOver = true; // Set game over state
               alert("Game Over! Your score: " + score);
           }
       });
   }

   // Jump function
   function jump() {
       if (jumpCount < maxJumps && !gameOver) { // Allow jump if under max jumps
           myVerticalVelocity = myJumpStrength; // Set the initial jump velocity
           jumpCount++; // Increment jump count
       }
   }

   // Add an event listener for the space bar
   document.addEventListener('keydown', function(event) {
       if (event.code === 'Space') {
           event.preventDefault(); // Prevent the default action (scrolling down)
           jump();
       }
   });

   // Reset jump count when character lands
   function resetJump() {
       if (parseInt(document.getElementById('myImg01').style.top) >= window.innerHeight - document.getElementById('myImg01').offsetHeight) {
           jumpCount = 0; // Reset jump count when on the ground
       }
   }

   // Call resetJump in myDoGravity
   function myDoGravity() {
       let img = document.getElementById('myImg01');
       myVerticalVelocity += myGravity; // Apply gravity to vertical velocity
       img.style.top = parseInt(img.style.top) + myVerticalVelocity + 'px'; // Update position
       resetJump(); // Reset jump count if on the ground

       // Check for ground collision
       if (parseInt(img.style.top) >= window.innerHeight - img.offsetHeight) {
           img.style.top = (window.innerHeight - img.offsetHeight) + 'px'; // Reset to ground level
           myVerticalVelocity = 0; // Reset vertical velocity
           gameOver = true; // Set game over state
           alert("Game Over! Your score: " + score);
       }
   }
</script>

<img id="myImg01" src="myImgNew.jpg" style="position:absolute; width:100px; height:80px; left: 50px; top:190px;">

</body>
